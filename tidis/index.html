<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Tidis - Distributed transactional NoSQL database, Redis protocol compatible using tikv as backend - 人生如逆旅，我亦是行人。</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="yongman">
<meta name=description content="Github repo: https://github.com/yongman/tidis StarWhat is Tidis? Tidis is a Distributed NoSQL database, providing a Redis protocol API (string, list, hash, set, sorted set), written in Go.
Tidis is like TiDB layer, providing protocol transform and data structure compute, powered by TiKV backend distributed storage which use Raft for data replication and 2PC for distributed transaction.
Features  Redis protocol compatible Linear scale-out ability Storage and computation separation Data safety, no data loss, Raft replication Transaction support  Any pull requests are welcomed.">
<meta name=keywords content="yongman,思考,人生,技术">
<meta name=generator content="Hugo 0.91.2">
<link rel=canonical href=https://xiking.win/tidis/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.31c4b7729c8d71cc152f8de4203d90bfd8a04f7eab69372de7234ebf55b7701b.css integrity="sha256-McS3cpyNccwVL43kID2Qv9igT36raTct5yNOv1W3cBs=" media=screen crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="Tidis - Distributed transactional NoSQL database, Redis protocol compatible using tikv as backend">
<meta property="og:description" content="Github repo: https://github.com/yongman/tidis StarWhat is Tidis? Tidis is a Distributed NoSQL database, providing a Redis protocol API (string, list, hash, set, sorted set), written in Go.
Tidis is like TiDB layer, providing protocol transform and data structure compute, powered by TiKV backend distributed storage which use Raft for data replication and 2PC for distributed transaction.
Features  Redis protocol compatible Linear scale-out ability Storage and computation separation Data safety, no data loss, Raft replication Transaction support  Any pull requests are welcomed.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://xiking.win/tidis/"><meta property="article:section" content>
<meta property="article:published_time" content="2018-08-10T13:58:30+00:00">
<meta property="article:modified_time" content="2018-08-10T13:58:30+00:00">
<meta itemprop=name content="Tidis - Distributed transactional NoSQL database, Redis protocol compatible using tikv as backend">
<meta itemprop=description content="Github repo: https://github.com/yongman/tidis StarWhat is Tidis? Tidis is a Distributed NoSQL database, providing a Redis protocol API (string, list, hash, set, sorted set), written in Go.
Tidis is like TiDB layer, providing protocol transform and data structure compute, powered by TiKV backend distributed storage which use Raft for data replication and 2PC for distributed transaction.
Features  Redis protocol compatible Linear scale-out ability Storage and computation separation Data safety, no data loss, Raft replication Transaction support  Any pull requests are welcomed."><meta itemprop=datePublished content="2018-08-10T13:58:30+00:00">
<meta itemprop=dateModified content="2018-08-10T13:58:30+00:00">
<meta itemprop=wordCount content="1917">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Tidis - Distributed transactional NoSQL database, Redis protocol compatible using tikv as backend">
<meta name=twitter:description content="Github repo: https://github.com/yongman/tidis StarWhat is Tidis? Tidis is a Distributed NoSQL database, providing a Redis protocol API (string, list, hash, set, sorted set), written in Go.
Tidis is like TiDB layer, providing protocol transform and data structure compute, powered by TiKV backend distributed storage which use Raft for data replication and 2PC for distributed transaction.
Features  Redis protocol compatible Linear scale-out ability Storage and computation separation Data safety, no data loss, Raft replication Transaction support  Any pull requests are welcomed."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>人生如逆旅，我亦是行人。</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://xiking.win/>首页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://xiking.win/post/>归档</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://xiking.win/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://xiking.win/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://xiking.win/about/>关于</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
人生如逆旅，我亦是行人。
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://xiking.win/>首页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://xiking.win/post/>归档</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://xiking.win/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://xiking.win/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://xiking.win/about/>关于</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight wallpaper">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>Tidis - Distributed transactional NoSQL database, Redis protocol compatible using tikv as backend</h1>
<div class=post-meta>
<time datetime=2018-08-10 class=post-time>
2018-08-10
</time>
</div>
</header>
<div class=post-content>
<p>Github repo: <a href=https://github.com/yongman/tidis>https://github.com/yongman/tidis</a>
Star</p>
<h1 id=what-is-tidis>What is Tidis?</h1>
<p><a href=https://github.com/yongman/tidis>Tidis</a> is a Distributed NoSQL database, providing a Redis protocol API (string, list, hash, set, sorted set), written in Go.</p>
<p>Tidis is like <a href=https://github.com/pingcap/tidb>TiDB</a> layer, providing protocol transform and data structure compute, powered by <a href=https://github.com/pingcap/tikv>TiKV</a> backend distributed storage which use Raft for data replication and 2PC for distributed transaction.</p>
<h2 id=features>Features</h2>
<ul>
<li>Redis protocol compatible</li>
<li>Linear scale-out ability</li>
<li>Storage and computation separation</li>
<li>Data safety, no data loss, Raft replication</li>
<li>Transaction support</li>
</ul>
<p>Any pull requests are welcomed.</p>
<h2 id=architecture>Architecture</h2>
<p><em>Architechture of tidis</em></p>
<p><img src=https://raw.githubusercontent.com/yongman/tidis/master/docs/tidis-arch.png alt=architecture></p>
<p><em>Architechture of tikv</em></p>
<p><img src=https://pingcap.com/images/blog/TiKV_%20Architecture.png alt></p>
<ul>
<li>Placement Driver (PD): PD is the brain of the TiKV system which manages the metadata about Nodes, Stores, Regions mapping, and makes decisions for data placement and load balancing. PD periodically checks replication constraints to balance load and data automatically.</li>
<li>Node: A physical node in the cluster. Within each node, there are one or more Stores. Within each Store, there are many Regions.</li>
<li>Store: There is a RocksDB within each Store and it stores data in local disks.</li>
<li>Region: Region is the basic unit of Key-Value data movement and corresponds to a data range in a Store. Each Region is replicated to multiple Nodes. These multiple replicas form a Raft group. A replica of a Region is called a Peer.</li>
</ul>
<h2 id=1-run-tidis-server-with-docker-compose-in-one-command>1. Run tidis server with docker-compose in one command</h2>
<pre tabindex=0><code>git clone https://github.com/yongman/tidis-docker-compose.git
cd tidis-docker-compose/
docker-compose up -d
</code></pre><p>Or follow <a href=https://github.com/yongman/tidis-docker-compose>tidis-docker-compose</a> guide to run with <code>docker-compose</code></p>
<h2 id=2-build-or-docker-mannualy>2. Build or Docker mannualy</h2>
<h3 id=build-from-source>Build from source</h3>
<pre tabindex=0><code>git clone https://github.com/yongman/tidis.git
cd tidis &amp;&amp; make
</code></pre><h3 id=pull-from-docker>Pull from docker</h3>
<pre tabindex=0><code>docker pull yongman/tidis
</code></pre><h3 id=run-tikv-cluster-for-test>Run TiKV cluster for test</h3>
<p>Use <code>docker run tikv</code> for test, just follow <a href=https://github.com/pingcap/docs/blob/master/op-guide/docker-deployment.md>PingCAP official guide</a>, you just need to deploy PD and TiKV servers, Tidis will take the role of TiDB.</p>
<h3 id=run-tidis-or-docker>Run Tidis or docker</h3>
<h4 id=run-tidis-from-executable-file>Run tidis from executable file</h4>
<pre tabindex=0><code>bin/tidis-server -conf config.toml
</code></pre><h3 id=run-tidis-from-docker>Run tidis from docker</h3>
<pre tabindex=0><code>docker run  -d --name tidis -p 5379:5379 -v {your_config_dir}:/data yongman/tidis -conf=&quot;/data/config.toml&quot;
</code></pre><h2 id=3-client-request>3. Client request</h2>
<pre tabindex=0><code>redis-cli -p 5379
127.0.0.1:5379&gt; get a
&quot;1&quot;
127.0.0.1:5379&gt; lrange l 0 -1
1) &quot;6&quot;
2) &quot;5&quot;
3) &quot;4&quot;
127.0.0.1:5379&gt; zadd zzz 1 1 2 2 3 3 4 4
(integer) 4
127.0.0.1:5379&gt; zcard zzz
(integer) 4
127.0.0.1:5379&gt; zincrby zzz 10 1
(integer) 11
127.0.0.1:5379&gt; zrange zzz 0 -1 withscores
1) &quot;2&quot;
2) &quot;2&quot;
3) &quot;3&quot;
4) &quot;3&quot;
5) &quot;4&quot;
6) &quot;4&quot;
7) &quot;1&quot;
8) &quot;11&quot;
</code></pre><h2 id=already-supported-commands>Already supported commands</h2>
<h3 id=keys>Keys</h3>
<pre><code>+-----------+-------------------------------------+
|  pexpire  | pexpire key int                     |
+-----------+-------------------------------------+
| pexpireat | pexpireat key timestamp(ms)         |
+-----------+-------------------------------------+
|   expire  | expire key int                      |
+-----------+-------------------------------------+
|  expireat | expireat key timestamp(s)           |
+-----------+-------------------------------------+
|    pttl   | pttl key                            |
+-----------+-------------------------------------+
|    ttl    | ttl key                             |
+-----------+-------------------------------------+
|    type   | type key                            |
+-----------+-------------------------------------+
</code></pre>
<h3 id=string>String</h3>
<pre><code>+-----------+-------------------------------------+
|  command  |               format                |
+-----------+-------------------------------------+
|    get    | get key                             |
+-----------+-------------------------------------+
|    set    | set key value [EX sec|PX ms][NX|XX] | 
+-----------+-------------------------------------+
|   getbit  | getbit key offset                   |
+-----------+-------------------------------------+
|   setbit  | setbit key offset value             |
+-----------+-------------------------------------+
|    del    | del key1 key2 ...                   |
+-----------+-------------------------------------+
|    mget   | mget key1 key2 ...                  |
+-----------+-------------------------------------+
|    mset   | mset key1 value1 key2 value2 ...    |
+-----------+-------------------------------------+
|    incr   | incr key                            |
+-----------+-------------------------------------+
|   incrby  | incr key step                       |
+-----------+-------------------------------------+
|    decr   | decr key                            |
+-----------+-------------------------------------+
|   decrby  | decrby key step                     |
+-----------+-------------------------------------+
|   strlen  | strlen key                          |
+-----------+-------------------------------------+
</code></pre>
<h3 id=hash>Hash</h3>
<pre><code>+------------+------------------------------------------+
|  Commands  | Format                                   |
+------------+------------------------------------------+
|    hget    | hget key field                           |
+------------+------------------------------------------+
|   hstrlen  | hstrlen key                              |
+------------+------------------------------------------+
|   hexists  | hexists key                              |
+------------+------------------------------------------+
|    hlen    | hlen key                                 |
+------------+------------------------------------------+
|    hmget   | hmget key field1 field2 field3...        |
+------------+------------------------------------------+
|    hdel    | hdel key field1 field2 field3...         |
+------------+------------------------------------------+
|    hset    | hset key field value                     |
+------------+------------------------------------------+
|   hsetnx   | hsetnx key field value                   |
+------------+------------------------------------------+
|    hmset   | hmset key field1 value1 field2 value2... |
+------------+------------------------------------------+
|    hkeys   | hkeys key                                |
+------------+------------------------------------------+
|    hvals   | hvals key                                |
+------------+------------------------------------------+
|   hgetall  | hgetall key                              |
+------------+------------------------------------------+
</code></pre>
<h3 id=list>List</h3>
<pre><code>+------------+-----------------------+
|  commands  |         format        |
+------------+-----------------------+
|    lpop    | lpop key              |
+------------+-----------------------+
|    rpush   | rpush key             |
+------------+-----------------------+
|    rpop    | rpop key              |
+------------+-----------------------+
|    llen    | llen key              |
+------------+-----------------------+
|   lindex   | lindex key index      |
+------------+-----------------------+
|   lrange   | lrange key start stop |
+------------+-----------------------+
|    lset    | lset key index value  |
+------------+-----------------------+
|    ltrim   | ltrim key start stop  |
+------------+-----------------------+
</code></pre>
<h3 id=set>Set</h3>
<pre><code>+-------------+--------------------------------+
|   commands  |             format             |
+-------------+--------------------------------+
|     sadd    | sadd key member1 [member2 ...] |
+-------------+--------------------------------+
|    scard    | scard key                      |
+-------------+--------------------------------+
|  sismember  | sismember key member           |
+-------------+--------------------------------+
|   smembers  | smembers key                   |
+-------------+--------------------------------+
|     srem    | srem key member                |
+-------------+--------------------------------+
|    sdiff    | sdiff key1 key2                |
+-------------+--------------------------------+
|    sunion   | sunion key1 key2               |
+-------------+--------------------------------+
|    sinter   | sinter key1 key2               |
+-------------+--------------------------------+
|  sdiffstore | sdiffstore key1 key2 key3      |
+-------------+--------------------------------+
| sunionstore | sunionstore key1 key2 key3     |
+-------------+--------------------------------+
| sinterstore | sinterstore key1 key2 key3     |
+-------------+--------------------------------+
</code></pre>
<h3 id=sorted-set>Sorted set</h3>
<pre><code>+------------------+---------------------------------------------------------------+
|     commands     |                             format                            |
+------------------+---------------------------------------------------------------+
|       zadd       | zadd key member1 score1 [member2 score2 ...]                  |
+------------------+---------------------------------------------------------------+
|       zcard      | zcard key                                                     |
+------------------+---------------------------------------------------------------+
|      zrange      | zrange key start stop [WITHSCORES]                            |
+------------------+---------------------------------------------------------------+
|     zrevrange    | zrevrange key start stop [WITHSCORES]                         |
+------------------+---------------------------------------------------------------+
|   zrangebyscore  | zrangebyscore key min max [WITHSCORES][LIMIT offset count]    |
+------------------+---------------------------------------------------------------+
| zrevrangebyscore | zrevrangebyscore key max min [WITHSCORES][LIMIT offset count] |
+------------------+---------------------------------------------------------------+
| zremrangebyscore | zremrangebyscore key min max                                  |
+------------------+---------------------------------------------------------------+
|    zrangebylex   | zrangebylex key min max [LIMIT offset count]                  |
+------------------+---------------------------------------------------------------+
|  zrevrangebylex  | zrevrangebylex key max min [LIMIT offset count]               |
+------------------+---------------------------------------------------------------+
|  zremrangebylex  | zremrangebylex key min max                                    |
+------------------+---------------------------------------------------------------+
|      zcount      | zcount key                                                    |
+------------------+---------------------------------------------------------------+
|     zlexcount    | zlexcount key                                                 |
+------------------+---------------------------------------------------------------+
|      zscore      | zscore key member                                             |
+------------------+---------------------------------------------------------------+
|       zrem       | zrem key member1 [member2 ...]                                |
+------------------+---------------------------------------------------------------+
|      zincrby     | zincrby key increment member                                  |
+------------------+---------------------------------------------------------------+
</code></pre>
<h3 id=transaction>Transaction</h3>
<pre><code>+---------+---------+
| command | support |
+---------+---------+
|  multi  | Yes     |
+---------+---------+
|   exec  | Yes     |
+---------+---------+
</code></pre>
<h3 id=server--connections>Server & Connections</h3>
<pre><code>+-----------+---------------+
| command  	| format     	|
+-----------+---------------+
| flushdb  	| flushdb id 	|
+-----------+---------------+
| flushall 	| flush      	|
+-----------+---------------+
| select   	| select id  	|
+-----------+---------------+
</code></pre>
<h2 id=benchmark>Benchmark</h2>
<p><a href=https://github.com/yongman/tidis/wiki/Tidis-base-benchmark>base benchmark</a></p>
<h3 id=environment>Environment</h3>
<ul>
<li>OS: Debian 8.6</li>
<li>Kernel: 3.16</li>
<li>Memory: 250GB</li>
<li>Processor: Intel(R) Xeon(R) CPU E5-2670 v3 @ 2.30GHz * 48</li>
<li>Disk: SATA (SSD is recommended)</li>
</ul>
<h2 id=configuration>Configuration</h2>
<ul>
<li>
<p>One pd server (run with docker)</p>
</li>
<li>
<p>One tikv server (run with docker), configuration as follows tikv.conf</p>
<pre tabindex=0><code>log-level = &quot;info&quot;
[server]
addr = &quot;ip:20160&quot;
[storage]
data-dir = &quot;tikv&quot;
[pd]
endpoints = [&quot;ip:2379&quot;]
[metric]
interval = &quot;1500s&quot;
address = &quot;&quot;
job = &quot;tikv&quot;
[raftstore]
sync-log = false
region-max-size = &quot;384MB&quot;
region-split-size = &quot;256MB&quot;
region-split-check-diff = &quot;32MB&quot;
[rocksdb]
max-manifest-file-size = &quot;20MB&quot;
[rocksdb.defaultcf]
block-size = &quot;64KB&quot;
compression-per-level = [&quot;no&quot;, &quot;no&quot;, &quot;lz4&quot;, &quot;lz4&quot;, &quot;lz4&quot;, &quot;zstd&quot;, &quot;zstd&quot;]
write-buffer-size = &quot;128MB&quot;
max-write-buffer-number = 5
level0-slowdown-writes-trigger = 20
level0-stop-writes-trigger = 36
max-bytes-for-level-base = &quot;512MB&quot;
target-file-size-base = &quot;32MB&quot;
[rocksdb.writecf]
compression-per-level = [&quot;no&quot;, &quot;no&quot;, &quot;lz4&quot;, &quot;lz4&quot;, &quot;lz4&quot;, &quot;zstd&quot;, &quot;zstd&quot;]
write-buffer-size = &quot;128MB&quot;
max-write-buffer-number = 5
min-write-buffer-number-to-merge = 1
max-bytes-for-level-base = &quot;512MB&quot;
target-file-size-base = &quot;32MB&quot;
[raftdb]
compaction-readahead-size = &quot;2MB&quot;
[raftdb.defaultcf]
compression-per-level = [&quot;no&quot;, &quot;no&quot;, &quot;lz4&quot;, &quot;lz4&quot;, &quot;lz4&quot;, &quot;zstd&quot;, &quot;zstd&quot;]
write-buffer-size = &quot;128MB&quot;
max-write-buffer-number = 5
min-write-buffer-number-to-merge = 1
max-bytes-for-level-base = &quot;512MB&quot;
target-file-size-base = &quot;32MB&quot;
block-cache-size = &quot;256MB&quot;
</code></pre></li>
<li>
<p>One tidis server with default configuration</p>
<pre tabindex=0><code>bin/tidis-server -backend ip:2379
</code></pre></li>
</ul>
<h3 id=use-redis-benchmark-with-transaction-support>Use redis-benchmark with transaction support</h3>
<ol>
<li>Let&rsquo;s start with one client concurrency</li>
</ol>
<ul>
<li>GET</li>
</ul>
<p><code>redis-benchmark -p 7379 -t GET -r 100000000 -n 10000 -c 1</code></p>
<pre tabindex=0><code>====== GET ======
  10000 requests completed in 5.64 seconds
  1 parallel clients
  3 bytes payload
  keep alive: 1

99.76% &lt;= 1 milliseconds
100.00% &lt;= 2 milliseconds
1773.05 requests per second
</code></pre><ul>
<li>SET</li>
</ul>
<p><code>redis-benchmark -p 7379 -t SET -r 100000000 -n 1000 -c 1</code></p>
<pre tabindex=0><code>====== SET ======
  1000 requests completed in 2.23 seconds
  1 parallel clients
  3 bytes payload
  keep alive: 1

0.10% &lt;= 1 milliseconds
12.80% &lt;= 2 milliseconds
99.30% &lt;= 3 milliseconds
99.90% &lt;= 4 milliseconds
100.00% &lt;= 8 milliseconds
448.83 requests per second
</code></pre><p>If you do this, you will find tidis is <em>quite slow</em>.</p>
<p>Why? The biggest reason is every write would create a transaction, and the transaction timestamp must be obtain from pd servers, and the request must be encoded/decoded and make a rpc request to tikv server and tikv server use raft for replication and twe-phase commit for distributed transaction, which cause the latancy higher. So throughput of one connection seems quit small.</p>
<ol start=2>
<li>Start with 50 concurrency</li>
</ol>
<ul>
<li>GET</li>
</ul>
<p><code>redis-benchmark -p 7379 -t GET -r 100000000 -n 10000 -c 50</code></p>
<pre tabindex=0><code>====== GET ======
  10000 requests completed in 0.52 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

28.86% &lt;= 1 milliseconds
43.97% &lt;= 2 milliseconds
67.82% &lt;= 3 milliseconds
82.37% &lt;= 4 milliseconds
88.53% &lt;= 5 milliseconds
93.77% &lt;= 6 milliseconds
96.76% &lt;= 7 milliseconds
98.05% &lt;= 8 milliseconds
98.98% &lt;= 9 milliseconds
99.44% &lt;= 10 milliseconds
99.71% &lt;= 11 milliseconds
99.87% &lt;= 12 milliseconds
99.93% &lt;= 13 milliseconds
99.99% &lt;= 14 milliseconds
100.00% &lt;= 15 milliseconds
19379.85 requests per second
</code></pre><ul>
<li>SET</li>
</ul>
<p><code>redis-benchmark -p 7379 -t SET -r 100000000 -n 10000 -c 50</code></p>
<pre tabindex=0><code>====== SET ======
  10000 requests completed in 1.21 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

0.01% &lt;= 1 milliseconds
0.03% &lt;= 2 milliseconds
0.70% &lt;= 3 milliseconds
9.10% &lt;= 4 milliseconds
31.07% &lt;= 5 milliseconds
57.32% &lt;= 6 milliseconds
77.68% &lt;= 7 milliseconds
89.09% &lt;= 8 milliseconds
94.78% &lt;= 9 milliseconds
97.63% &lt;= 10 milliseconds
98.49% &lt;= 11 milliseconds
98.86% &lt;= 12 milliseconds
99.05% &lt;= 13 milliseconds
99.09% &lt;= 14 milliseconds
99.12% &lt;= 15 milliseconds
99.23% &lt;= 16 milliseconds
99.29% &lt;= 17 milliseconds
99.45% &lt;= 18 milliseconds
99.60% &lt;= 19 milliseconds
99.80% &lt;= 20 milliseconds
99.93% &lt;= 21 milliseconds
99.99% &lt;= 22 milliseconds
100.00% &lt;= 24 milliseconds
8271.30 requests per second
</code></pre><ol start=3>
<li>Let&rsquo;s write batch in one transaction</li>
</ol>
<ul>
<li>One client with batch 10 writes in one transaction</li>
</ul>
<p><code>redis-benchmark -p 7379 -t SET -r 100000000 -n 10000 -c 1 -T 10</code></p>
<pre tabindex=0><code>====== SET ======
  10000 requests completed in 2.54 seconds
  1 parallel clients
  3 bytes payload
  keep alive: 1

3933.91 requests per second
</code></pre><ul>
<li>50 concurrent clients with batch 10 writes in one transaction</li>
</ul>
<p><code>redis-benchmark -p 7379 -t SET -r 100000000 -n 100000 -c 50 -T 10</code></p>
<pre tabindex=0><code>====== SET ======
  100000 requests completed in 1.55 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1

64516.13 requests per second
</code></pre><ul>
<li>1000 concurrent clients with batch 100 writes in one transaction</li>
</ul>
<p><code>redis-benchmark -p 7379 -t SET -r 100000000 -n 1000000 -c 1000 -T 100</code></p>
<pre tabindex=0><code>====== SET ======
  1000000 requests completed in 10.19 seconds
  1000 parallel clients
  3 bytes payload
  keep alive: 1

89.90% &lt;= 1 milliseconds
89.94% &lt;= 4 milliseconds
89.96% &lt;= 5 milliseconds
89.99% &lt;= 7 milliseconds
90.00% &lt;= 21 milliseconds
90.01% &lt;= 23 milliseconds
90.02% &lt;= 24 milliseconds
90.03% &lt;= 25 milliseconds
90.06% &lt;= 26 milliseconds
90.15% &lt;= 27 milliseconds
90.29% &lt;= 28 milliseconds
90.52% &lt;= 29 milliseconds
90.95% &lt;= 30 milliseconds
91.53% &lt;= 31 milliseconds
92.44% &lt;= 32 milliseconds
94.50% &lt;= 33 milliseconds
96.27% &lt;= 34 milliseconds
97.32% &lt;= 35 milliseconds
98.27% &lt;= 36 milliseconds
98.87% &lt;= 37 milliseconds
99.16% &lt;= 38 milliseconds
99.31% &lt;= 39 milliseconds
99.51% &lt;= 40 milliseconds
99.58% &lt;= 41 milliseconds
99.64% &lt;= 42 milliseconds
99.73% &lt;= 43 milliseconds
99.83% &lt;= 44 milliseconds
99.90% &lt;= 45 milliseconds
99.92% &lt;= 46 milliseconds
99.94% &lt;= 47 milliseconds
99.95% &lt;= 48 milliseconds
99.98% &lt;= 49 milliseconds
99.99% &lt;= 50 milliseconds
100.00% &lt;= 50 milliseconds
98183.60 requests per second
</code></pre><p>This is a base benchmark for now, more scenarios bench data need be added.</p>
<h2 id=license>License</h2>
<p>Tidis is under the MIT license. See the <a href=https://github.com/yongman/tidis/blob/master/LICENSE>LICENSE</a> file for details.</p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>Author</span>
<span class=item-content>yongman</span>
</p>
<p class=copyright-item>
<span class=item-title>LastMod</span>
<span class=item-content>
2018-08-10
</span>
</p>
<p class=copyright-item>
<span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
</article>
<div class=disqus-comment>
<div class=disqus-button id=load_disqus onclick=load_disqus()>
Show Disqus Comments
</div>
<div id=disqus_thread></div>
<script type=text/javascript>var disqus_config=function(){this.page.url="https://xiking.win/tidis/"};function load_disqus(){var a,b;if(window.location.hostname==='localhost')return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='xiking-win',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a),$('#load_disqus').remove()}</script>
<noscript>Please enable JavaScript to view the
<a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a>
</noscript>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:yming0221@gmail.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://twitter.com/YongXMan rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358C960.484169-78.763856 560.627046-7.210476 627.971403 308.466201 278.622548 312.675223 89.216542 47.506814 89.216542 47.506814S-28.636084 236.91282 164.978944 392.646647C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042 50.5082679999998-16.83609 134.688715-143.10676 134.688715-143.10676s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg>
</a>
<a href=https://github.com/yongman rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://xiking.win/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2018 -
2023
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
yongman
</span></span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
</body>
</html>